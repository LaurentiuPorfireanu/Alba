<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Security AI Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }

        .header {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.8;
        }

        .tab-container {
            background: rgba(0, 0, 0, 0.2);
            padding: 0;
            margin: 0;
        }

        .tab-nav {
            display: flex;
            justify-content: center;
            background: transparent;
        }

        .tab-button {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 15px 30px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .tab-button.active {
            background: rgba(255, 255, 255, 0.3);
            border-bottom: 3px solid #74b9ff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .panel h3 {
            margin-bottom: 15px;
            color: #fff;
            font-size: 1.3em;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn.success {
            background: linear-gradient(45deg, #00b894, #00a085);
        }

        .btn.warning {
            background: linear-gradient(45deg, #fdcb6e, #e17055);
        }

        .btn.info {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
        }

        .btn.training {
            background: linear-gradient(45deg, #fdcb6e, #f39c12);
        }

        .btn.testing {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .mode-indicator {
            text-align: center;
            padding: 15px;
            margin: 20px 0;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.2em;
        }

        .mode-training {
            background: rgba(253, 203, 110, 0.2);
            border: 2px solid #fdcb6e;
            color: #fdcb6e;
        }

        .mode-testing {
            background: rgba(231, 76, 60, 0.2);
            border: 2px solid #e74c3c;
            color: #e74c3c;
        }

        .mode-idle {
            background: rgba(116, 185, 255, 0.2);
            border: 2px solid #74b9ff;
            color: #74b9ff;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active {
            background: #00b894;
            box-shadow: 0 0 10px #00b894;
        }

        .status-inactive {
            background: #636e72;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #74b9ff;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }

        .log-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 5px;
            border-radius: 5px;
        }

        .log-normal {
            background: rgba(116, 185, 255, 0.1);
        }

        .log-warning {
            background: rgba(253, 203, 110, 0.2);
        }

        .log-danger {
            background: rgba(255, 107, 107, 0.2);
        }

        .chart-container {
            height: 300px;
            margin-top: 15px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            margin: 0 10px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: #00b894;
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        .progress-bar {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .training-section {
            border: 2px solid rgba(253, 203, 110, 0.3);
            background: rgba(253, 203, 110, 0.1);
        }

        .testing-section {
            border: 2px solid rgba(231, 76, 60, 0.3);
            background: rgba(231, 76, 60, 0.1);
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>Network Security AI System</h1>
        <p class="subtitle">AI-Powered Network Security Training & Testing Platform</p>
    </div>

    <div class="tab-container">
        <div class="tab-nav">
            <button class="tab-button active" onclick="switchTab('training')">üéì Training Mode</button>
            <button class="tab-button" onclick="switchTab('testing')">üõ°Ô∏è Testing Mode</button>
            <button class="tab-button" onclick="switchTab('monitoring')">üìä Monitoring</button>
        </div>
    </div>

    <div id="modeIndicator" class="mode-indicator mode-idle">
        ü§ñ System Ready - Select Training or Testing Mode
    </div>

    <!-- Training Tab -->
    <div id="training" class="tab-content active">
        <div class="dashboard">
            <div class="panel training-section">
                <h3>üéì AI Training Center</h3>
                <p style="opacity: 0.8; margin-bottom: 15px;">Train AI models using synthetic data and real network
                    patterns</p>

                <div class="controls">
                    <button class="btn training" onclick="startContinuousTraining()">Start Continuous Training</button>
                    <button class="btn warning" onclick="stopTraining()">Stop Training</button>
                    <button class="btn success" onclick="saveAIModels()">Save Models</button>
                </div>

                <div id="trainingProgress" class="progress-bar" style="display: none;">
                    <div class="progress-fill" id="trainingProgressFill"></div>
                </div>

                <div id="trainingStatus" style="margin: 10px 0; font-weight: bold;">
                    Status: Ready for training
                </div>
                <div id="trainingSamples" style="font-size: 0.9em; opacity: 0.8;">
                    Training Samples: 0
                </div>
            </div>

            <div class="panel">
                <h3>üìä Training Data Generator</h3>
                <div class="controls">
                    <button class="btn info" onclick="generateTrainingData('normal')">Generate Normal Traffic</button>
                    <button class="btn warning" onclick="generateTrainingData('attack')">Generate Attack Data</button>
                    <button class="btn" onclick="generateTrainingData('mixed')">Generate Mixed Dataset</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="normalSamples">0</div>
                        <div class="stat-label">Normal Samples</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="attackSamples">0</div>
                        <div class="stat-label">Attack Samples</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3>üéØ Model Performance</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="modelAccuracy">0%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="trainingEpochs">0</div>
                        <div class="stat-label">Epochs</div>
                    </div>
                </div>

                <div class="chart-container" id="trainingChart"></div>
            </div>

            <div class="panel">
                <h3>üìù Training Logs</h3>
                <div class="log-container" id="trainingLog">
                    <div class="log-entry log-normal">Training system initialized...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Testing Tab -->
    <div id="testing" class="tab-content">
        <div class="dashboard">
            <div class="panel testing-section">
                <h3>üõ°Ô∏è Defense Testing Center</h3>
                <p style="opacity: 0.8; margin-bottom: 15px;">Test trained AI models against simulated attacks</p>

                <div class="controls">
                    <button class="btn testing" id="enableTestingBtn" onclick="enableTesting()">Enable Testing
                        Mode</button>
                    <button class="btn warning" id="disableTestingBtn" onclick="disableTesting()"
                        style="display: none;">Disable Testing</button>
                    <button class="btn" onclick="resetTestResults()">Reset Results</button>
                </div>

                <div style="margin: 15px 0;">
                    <label>
                        Auto Attack Simulation:
                        <div class="toggle-switch">
                            <input type="checkbox" id="autoAttackToggle" onchange="toggleAutoAttack()">
                            <span class="slider"></span>
                        </div>
                    </label>
                </div>

                <div id="testingStatus" style="margin: 10px 0; font-weight: bold;">
                    Status: Testing mode disabled
                </div>
            </div>

            <div class="panel">
                <h3>‚öîÔ∏è Attack Simulator</h3>
                <div class="controls">
                    <button class="btn testing" onclick="launchAttack('DDoS')">DDoS Attack</button>
                    <button class="btn testing" onclick="launchAttack('Port Scan')">Port Scan</button>
                    <button class="btn testing" onclick="launchAttack('Brute Force')">Brute Force</button>
                    <button class="btn testing" onclick="launchAttack()">Random Attack</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalAttacks">0</div>
                        <div class="stat-label">Total Attacks</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="lastAttackType">None</div>
                        <div class="stat-label">Last Attack</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3>üõ°Ô∏è Defense Results</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="blockedAttacks">0</div>
                        <div class="stat-label">Blocked Attacks</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="detectionRate">0%</div>
                        <div class="stat-label">Detection Rate</div>
                    </div>
                </div>

                <div class="log-container" id="defenseLog">
                    <div class="log-entry log-normal">Defense system ready...</div>
                </div>
            </div>

            <div class="panel">
                <h3>üìà Testing Analysis</h3>
                <div class="chart-container" id="testingChart"></div>
            </div>
        </div>
    </div>

    <!-- Monitoring Tab -->
    <div id="monitoring" class="tab-content">
        <div class="dashboard">
            <div class="panel">
                <h3>üîß System Control</h3>
                <div class="controls">
                    <button class="btn success" onclick="startMonitoring()">Start Monitor</button>
                    <button class="btn warning" onclick="stopMonitoring()">Stop Monitor</button>
                    <button class="btn" onclick="resetSystem()">Reset System</button>
                </div>

                <div style="margin: 15px 0;">
                    <label>
                        <span class="status-indicator" id="monitorStatus"></span>
                        Network Monitoring
                    </label>
                </div>
            </div>

            <div class="panel">
                <h3>üì° Network Traffic</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalPackets">0</div>
                        <div class="stat-label">Total Packets</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="anomalies">0</div>
                        <div class="stat-label">Anomalies</div>
                    </div>
                </div>

                <div class="chart-container" id="trafficChart"></div>
            </div>

            <div class="panel">
                <h3>üìã System Activity</h3>
                <div class="log-container" id="systemLog">
                    <div class="log-entry log-normal">System started successfully...</div>
                </div>
            </div>

            <div class="panel">
                <h3>üìä Real-time Statistics</h3>
                <div class="chart-container" id="realtimeChart"></div>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'training';
        let updateInterval;
        let anomalyCount = 0;
        let testingActive = false;
        let trainingActive = false;
        let trainingData = {
            epochs: [],
            accuracy: [],
            loss: []
        };

        // Tab Management
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            currentTab = tabName;
            updateModeIndicator();
        }

        function updateModeIndicator() {
            const indicator = document.getElementById('modeIndicator');

            if (trainingActive) {
                indicator.className = 'mode-indicator mode-training';
                indicator.innerHTML = 'üéì Training Mode Active - AI Learning in Progress';
            } else if (testingActive) {
                indicator.className = 'mode-indicator mode-testing';
                indicator.innerHTML = 'üõ°Ô∏è Testing Mode Active - Defense Systems Online';
            } else if (currentTab === 'training') {
                indicator.className = 'mode-indicator mode-idle';
                indicator.innerHTML = 'üéì Training Mode Ready - Configure AI Training';
            } else if (currentTab === 'testing') {
                indicator.className = 'mode-indicator mode-idle';
                indicator.innerHTML = 'üõ°Ô∏è Testing Mode Ready - Load Trained Models';
            } else {
                indicator.className = 'mode-indicator mode-idle';
                indicator.innerHTML = 'üìä Monitoring Mode - System Observation';
            }
        }

        // Training Functions
        function startContinuousTraining() {
            if (testingActive) {
                alert('Cannot start training while testing mode is active!');
                return;
            }

            trainingActive = true;
            updateModeIndicator();

            document.getElementById('trainingStatus').innerHTML = 'Status: <span style="color: #fdcb6e;">Continuous Training Active...</span>';
            document.getElementById('trainingProgress').style.display = 'block';

            fetch('/api/continuous_training', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enabled: true })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        addLogEntry('trainingLog', 'Continuous training started...', 'normal');
                        startTrainingProgressSimulation();
                    } else {
                        trainingActive = false;
                        updateModeIndicator();
                        addLogEntry('trainingLog', `Training error: ${data.message}`, 'danger');
                    }
                });
        }

        function stopTraining() {
            trainingActive = false;
            updateModeIndicator();

            document.getElementById('trainingStatus').innerHTML = 'Status: <span style="color: #636e72;">Training Stopped</span>';
            document.getElementById('trainingProgress').style.display = 'none';

            fetch('/api/continuous_training', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enabled: false })
            })
                .then(response => response.json())
                .then(data => {
                    addLogEntry('trainingLog', 'Training stopped', 'warning');
                });
        }

        function startTrainingProgressSimulation() {
            let epoch = 0;
            const maxEpochs = 500;

            const progressInterval = setInterval(() => {
                if (!trainingActive) {
                    clearInterval(progressInterval);
                    return;
                }

                epoch++;
                const progress = (epoch / maxEpochs) * 100;
                document.getElementById('trainingProgressFill').style.width = Math.min(progress, 100) + '%';

                const baseAccuracy = Math.min(95, 20 + epoch * 0.15);
                const accuracy = baseAccuracy + (5 * (1 - 1 / (1 + epoch / 20))) + (Math.random() * 2 - 1);
                const finalAccuracy = Math.min(95, Math.max(20, accuracy));

                const baseLoss = Math.max(0.01, 2 - epoch * 0.004);
                const loss = baseLoss * (1 + (Math.random() * 0.1 - 0.05));

                trainingData.epochs.push(epoch);
                trainingData.accuracy.push(finalAccuracy);
                trainingData.loss.push(loss);

                document.getElementById('modelAccuracy').textContent = Math.round(finalAccuracy) + '%';
                document.getElementById('trainingEpochs').textContent = epoch;

                if (epoch % 5 === 0) {
                    updateTrainingChart();
                }

                if (trainingData.epochs.length > 100) {
                    trainingData.epochs = trainingData.epochs.slice(-100);
                    trainingData.accuracy = trainingData.accuracy.slice(-100);
                    trainingData.loss = trainingData.loss.slice(-100);
                }

            }, 200);
        }

        function saveAIModels() {
            fetch('/api/save_ai_models')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('trainingStatus').innerHTML = 'Status: <span style="color: #00b894;">Models Saved Successfully</span>';
                        addLogEntry('trainingLog', 'AI models saved successfully', 'normal');
                    } else {
                        addLogEntry('trainingLog', `Error saving models: ${data.message}`, 'danger');
                    }
                });
        }

        function generateTrainingData(type) {
            addLogEntry('trainingLog', `Generating ${type} training data...`, 'normal');

            fetch(`/api/generate_training_data?type=${type}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        addLogEntry('trainingLog', `Generated ${data.count} ${type} samples`, 'normal');
                        updateTrainingStats();
                    }
                })
                .catch(() => {
                    const count = Math.floor(Math.random() * 500) + 100;
                    addLogEntry('trainingLog', `Generated ${count} ${type} samples`, 'normal');

                    const currentNormal = parseInt(document.getElementById('normalSamples').textContent) || 0;
                    const currentAttack = parseInt(document.getElementById('attackSamples').textContent) || 0;

                    if (type === 'normal') {
                        document.getElementById('normalSamples').textContent = currentNormal + count;
                    } else if (type === 'attack') {
                        document.getElementById('attackSamples').textContent = currentAttack + count;
                    } else if (type === 'mixed') {
                        document.getElementById('normalSamples').textContent = currentNormal + Math.floor(count * 0.7);
                        document.getElementById('attackSamples').textContent = currentAttack + Math.floor(count * 0.3);
                    }
                });
        }

        // Testing Functions
        function enableTesting() {
            if (trainingActive) {
                alert('Cannot enable testing while training is active! Stop training first.');
                return;
            }

            testingActive = true;
            updateModeIndicator();

            document.getElementById('enableTestingBtn').style.display = 'none';
            document.getElementById('disableTestingBtn').style.display = 'inline-block';
            document.getElementById('testingStatus').innerHTML = 'Status: <span style="color: #e74c3c;">Testing Mode Active</span>';

            fetch('/api/enable_testing_mode', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enabled: true })
            })
                .then(response => response.json())
                .then(data => {
                    addLogEntry('defenseLog', 'Testing mode enabled - Defense systems online', 'normal');
                });
        }

        function disableTesting() {
            testingActive = false;
            updateModeIndicator();

            document.getElementById('enableTestingBtn').style.display = 'inline-block';
            document.getElementById('disableTestingBtn').style.display = 'none';
            document.getElementById('testingStatus').innerHTML = 'Status: <span style="color: #636e72;">Testing Mode Disabled</span>';

            document.getElementById('autoAttackToggle').checked = false;

            fetch('/api/enable_testing_mode', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enabled: false })
            })
                .then(response => response.json())
                .then(data => {
                    addLogEntry('defenseLog', 'Testing mode disabled', 'warning');
                });
        }

        function toggleAutoAttack() {
            if (!testingActive) {
                alert('Enable testing mode first!');
                document.getElementById('autoAttackToggle').checked = false;
                return;
            }

            const enabled = document.getElementById('autoAttackToggle').checked;

            fetch('/api/auto_attack', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enabled: enabled, interval: 3 })
            })
                .then(response => response.json())
                .then(data => {
                    addLogEntry('defenseLog', `Auto attack ${enabled ? 'enabled' : 'disabled'}`, 'normal');
                });
        }

        function launchAttack(type = null) {
            if (!testingActive) {
                alert('Enable testing mode first!');
                return;
            }

            const url = type ? `/api/launch_attack?type=${type}` : '/api/launch_attack';

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    addLogEntry('defenseLog', `Attack launched: ${data.attack.type}`, 'danger');

                    if (data.defense) {
                        addLogEntry('defenseLog', `Defense: ${data.defense.action} (${data.defense.threat_level})`,
                            data.defense.blocked ? 'danger' : 'warning');
                    }

                    updateTestingStats();
                });
        }

        function resetTestResults() {
            fetch('/api/reset_test_results')
                .then(response => response.json())
                .then(data => {
                    addLogEntry('defenseLog', 'Test results reset', 'normal');
                    updateTestingStats();
                });
        }

        // Monitoring Functions
        function startMonitoring() {
            fetch('/api/start_monitoring')
                .then(response => response.json())
                .then(data => {
                    addLogEntry('systemLog', data.message, 'normal');
                    updateSystemStatus();
                });
        }

        function stopMonitoring() {
            fetch('/api/stop_monitoring')
                .then(response => response.json())
                .then(data => {
                    addLogEntry('systemLog', data.message, 'warning');
                    updateSystemStatus();
                });
        }

        function resetSystem() {
            fetch('/api/reset_system')
                .then(response => response.json())
                .then(data => {
                    addLogEntry('systemLog', 'System reset completed', 'normal');

                    document.getElementById('autoAttackToggle').checked = false;
                    document.getElementById('enableTestingBtn').style.display = 'inline-block';
                    document.getElementById('disableTestingBtn').style.display = 'none';
                    document.getElementById('trainingProgress').style.display = 'none';

                    trainingData = { epochs: [], accuracy: [], loss: [] };

                    updateStats();
                });
        }

        // Utility Functions
        function addLogEntry(container, message, type = 'normal') {
            const logContainer = document.getElementById(container);
            if (!logContainer) return;

            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;

            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;

            while (logContainer.children.length > 50) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }

        function updateSystemStatus() {
            fetch('/api/system_status')
                .then(response => response.json())
                .then(data => {
                    const monitorStatus = document.getElementById('monitorStatus');
                    if (monitorStatus) {
                        monitorStatus.className = data.monitoring ? 'status-indicator status-active' : 'status-indicator status-inactive';
                    }
                })
                .catch(error => console.log('Status update failed:', error));
        }

        function updateStats() {
            updateTrainingStats();
            updateTestingStats();
            updateMonitoringStats();
        }

        function updateTrainingStats() {
            fetch('/api/training_stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('trainingSamples').textContent = `Training Samples: ${data.total_samples || 0}`;
                    document.getElementById('normalSamples').textContent = data.normal_samples || 0;
                    document.getElementById('attackSamples').textContent = data.attack_samples || 0;

                    if (!trainingActive) {
                        document.getElementById('modelAccuracy').textContent = `${data.accuracy || 0}%`;
                        document.getElementById('trainingEpochs').textContent = data.epochs || 0;
                    }
                })
                .catch(() => {
                    fetch('/api/defense_stats')
                        .then(response => response.json())
                        .then(data => {
                            document.getElementById('trainingSamples').textContent = `Training Samples: ${data.training_samples || 0}`;
                        })
                        .catch(error => console.log('Training stats failed:', error));
                });
        }

        function updateTestingStats() {
            fetch('/api/attack_stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('totalAttacks').textContent = data.total_attacks || 0;
                    document.getElementById('lastAttackType').textContent =
                        data.last_attack ? data.last_attack.type : 'None';
                })
                .catch(error => console.log('Attack stats failed:', error));

            fetch('/api/defense_stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('blockedAttacks').textContent = data.total_actions || 0;

                    const totalAttacks = parseInt(document.getElementById('totalAttacks').textContent) || 1;
                    const blockedAttacks = data.total_actions || 0;
                    const detectionRate = Math.round((blockedAttacks / totalAttacks) * 100);
                    document.getElementById('detectionRate').textContent = `${detectionRate}%`;
                })
                .catch(error => console.log('Defense stats failed:', error));
        }

        function updateMonitoringStats() {
            fetch('/api/network_stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('totalPackets').textContent = data.stats.total_packets || 0;
                    updateTrafficChart(data.recent_traffic);
                })
                .catch(error => console.log('Network stats failed:', error));

            fetch('/api/detect_anomaly')
                .then(response => response.json())
                .then(data => {
                    if (data.anomaly_detected) {
                        anomalyCount++;
                        addLogEntry('systemLog', `Anomaly detected! Confidence: ${data.confidence.toFixed(2)}`, 'danger');
                    }
                    document.getElementById('anomalies').textContent = anomalyCount;
                })
                .catch(error => console.log('Anomaly detection failed:', error));
        }

        function updateTrafficChart(trafficData) {
            if (!trafficData || trafficData.length === 0) return;

            const timestamps = trafficData.map(d => new Date(d.timestamp * 1000));
            const packetSizes = trafficData.map(d => d.packet_size);

            const trace = {
                x: timestamps,
                y: packetSizes,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Packet Size',
                line: { color: '#74b9ff' }
            };

            const layout = {
                title: 'Real-time Traffic',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0.2)',
                font: { color: 'white' },
                xaxis: { color: 'white' },
                yaxis: { color: 'white' },
                margin: { t: 50, b: 50, l: 50, r: 20 }
            };

            Plotly.newPlot('trafficChart', [trace], layout, { responsive: true });
        }

        function updateTrainingChart() {
            if (trainingData.epochs.length === 0) return;

            const trace1 = {
                x: trainingData.epochs,
                y: trainingData.accuracy,
                type: 'scatter',
                mode: 'lines',
                name: 'Accuracy (%)',
                line: { color: '#00b894', width: 3 }
            };

            const trace2 = {
                x: trainingData.epochs,
                y: trainingData.loss,
                type: 'scatter',
                mode: 'lines',
                name: 'Loss',
                yaxis: 'y2',
                line: { color: '#ff6b6b', width: 3 }
            };

            const layout = {
                title: {
                    text: 'Training Progress',
                    font: { color: 'white', size: 16 }
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0.2)',
                font: { color: 'white' },
                xaxis: {
                    color: 'white',
                    title: 'Epochs',
                    gridcolor: 'rgba(255,255,255,0.1)'
                },
                yaxis: {
                    color: 'white',
                    title: 'Accuracy (%)',
                    range: [0, 100],
                    gridcolor: 'rgba(255,255,255,0.1)'
                },
                yaxis2: {
                    title: 'Loss',
                    titlefont: { color: '#ff6b6b' },
                    tickfont: { color: '#ff6b6b' },
                    overlaying: 'y',
                    side: 'right',
                    range: [0, 2]
                },
                legend: {
                    font: { color: 'white' }
                },
                margin: { t: 50, b: 50, l: 50, r: 50 }
            };

            Plotly.newPlot('trainingChart', [trace1, trace2], layout, { responsive: true });
        }

        function updateTestingChart() {
            const categories = ['DDoS', 'Port Scan', 'Brute Force', 'XSS', 'SQL Injection'];
            const detected = [95, 88, 92, 76, 84];
            const missed = [5, 12, 8, 24, 16];

            const trace1 = {
                x: categories,
                y: detected,
                name: 'Detected',
                type: 'bar',
                marker: { color: '#00b894' }
            };

            const trace2 = {
                x: categories,
                y: missed,
                name: 'Missed',
                type: 'bar',
                marker: { color: '#ff6b6b' }
            };

            const layout = {
                title: 'Attack Detection Results (%)',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0.2)',
                font: { color: 'white' },
                xaxis: { color: 'white' },
                yaxis: { color: 'white' },
                barmode: 'stack',
                margin: { t: 50, b: 80, l: 50, r: 20 }
            };

            Plotly.newPlot('testingChart', [trace1, trace2], layout, { responsive: true });
        }

        function updateRealtimeChart() {
            const timeNow = new Date();
            const times = [];
            const cpuUsage = [];
            const memoryUsage = [];

            for (let i = 19; i >= 0; i--) {
                times.push(new Date(timeNow.getTime() - i * 3000));
                cpuUsage.push(Math.random() * 50 + 20);
                memoryUsage.push(Math.random() * 30 + 40);
            }

            const trace1 = {
                x: times,
                y: cpuUsage,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'CPU Usage (%)',
                line: { color: '#74b9ff' }
            };

            const trace2 = {
                x: times,
                y: memoryUsage,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Memory Usage (%)',
                line: { color: '#fdcb6e' }
            };

            const layout = {
                title: 'System Resources',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0.2)',
                font: { color: 'white' },
                xaxis: {
                    color: 'white',
                    type: 'date'
                },
                yaxis: {
                    color: 'white',
                    range: [0, 100]
                },
                legend: {
                    font: { color: 'white' }
                },
                margin: { t: 50, b: 50, l: 50, r: 20 }
            };

            Plotly.newPlot('realtimeChart', [trace1, trace2], layout, { responsive: true });
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function () {
            updateSystemStatus();
            updateStats();
            updateModeIndicator();

            updateTrainingChart();
            updateTestingChart();
            updateRealtimeChart();

            updateInterval = setInterval(() => {
                if (currentTab === 'training') {
                    updateTrainingStats();
                } else if (currentTab === 'testing') {
                    updateTestingStats();
                } else if (currentTab === 'monitoring') {
                    updateMonitoringStats();
                    updateRealtimeChart();
                }
            }, 3000);
        });
    </script>
</body>

</html>